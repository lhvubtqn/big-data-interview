# HDFS Architecture

### 1. HDFS 1.0

HDFS adopts the Master/Slave architecture, and an HDFS cluster contains a single NameNode and multiple DataNode nodes.

#### NameNode

The NameNode is responsible for managing the metadata of the entire distributed system, including:

- Directory tree structure;
- The mapping relationship between files and data blocks;
- Management data such as block copies and their storage locations;
- Status monitoring of DataNode, the two transmit management information and data information through heartbeats at intervals. Through this information transmission, NameNode can learn the block information saved by each DataNode, the health status of DataNode, and instruct DataNode to start and stop, etc. (If a DataNode is found to be faulty, the NameNode will back up the blocks it is responsible for on other DataNodes).

This data is kept in memory, and two metadata management files are kept on disk: `fsimage` and `editlog`.

- `fsimage`: is the image file of the memory namespace metadata in the external storage;
- `editlog`: It is a write-ahead-log file for various metadata operations. Before the changes in memory data are reflected, the operations are first recorded in the editlog to prevent data loss.

The combination of these two files can construct the complete in-memory data.

#### Secondary NameNode

Secondary NameNode is not the standby machine of NameNode, but periodically pulls `fsimage` and `editlog` files from NameNode, and merges the two files to form a new `fsimage` file and transmits it back to NameNode. The purpose of this is to reduce the workload of NameNode. In essence, SNN is a service point that provides checkpoint function services.

#### DataNode

Responsible for the actual storage and reading and writing of data blocks. The default value of a block is 64MB (changed to 128MB in HDFS2.0). When the client uploads a large file, HDFS will automatically cut it into blocks of fixed size to ensure data availability. Each block will be stored in the form of multiple backups, the default is 3 copies.

------

### 2. HDFS 2.0

![HDFS 2.0](../../../pictures/hdfs-ha.png)

- **Active NameNode and Standby NameNode**: Two NameNodes form mutual backup, one is in Active state and is the main NameNode, and the other is in Standby state and is the standby NameNode, only the main NameNode can provide external read and write services;

- **ZKFailoverController** (active/standby switchover controller, FC): ZKFailoverController runs as an independent process and performs overall control over the active/standby switchover of the NameNode. ZKFailoverController can detect the health status of NameNode in time, and realize automatic active/standby election and switchover with Zookeeper when the primary NameNode fails (of course, NameNode currently supports manual active/standby switchover that does not depend on Zookeeper);

- **Zookeeper cluster**: Provides active and standby election support for active and standby switching controllers;

- **Shared storage system**ï¼šThe shared storage system is the most critical part to achive the high availability of the NameNode. The shared storage system saves the metadata of the HDFS generated by the NameNode during the running process. The primary NameNode and the secondary NameNode implement metadata synchronization through the shared storage system. During the master-slave switchover, the new master NameNode **can continue to provide external services after confirming that the metadata is fully synchronized**.

- **DataNodes**: Because the primary NameNode and the secondary NameNode need to share the mapping relationship between HDFS data blocks and DataNodes, in order to enable fast failover, the DataNode will report the location information of the data blocks to the primary NameNode and the secondary NameNode at the same time.


See the [original article](<http://matt33.com/2018/07/15/hdfs-architecture-learn/#HDFS-2-0-%E7%9A%84-HA-%E5%AE%9E%E7%8E%B0>) for more information.

### 3. HDFS 3.0